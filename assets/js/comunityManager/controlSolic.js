let español = {
  aria: {
    sortAscending: "Activar para ordenar la columna de manera ascendente",
    sortDescending: "Activar para ordenar la columna de manera descendente",
  },
  autoFill: {
    cancel: "Cancelar",
    fill: "Rellene todas las celdas con <i>%d</i>",
    fillHorizontal: "Rellenar celdas horizontalmente",
    fillVertical: "Rellenar celdas verticalmente",
  },
  buttons: {
    collection: "Colección",
    colvis: "Visibilidad",
    colvisRestore: "Restaurar visibilidad",
    copy: "Copiar",
    copyKeys:
      "Presione ctrl o u2318 + C para copiar los datos de la tabla al portapapeles del sistema. <br /> <br /> Para cancelar, haga clic en este mensaje o presione escape.",
    copySuccess: {
      1: "Copiada 1 fila al portapapeles",
      _: "Copiadas %d fila al portapapeles",
    },
    copyTitle: "Copiar al portapapeles",
    csv: "CSV",
    excel: "Excel",
    pageLength: {
      "-1": "Mostrar todas las filas",
      _: "Mostrar %d filas",
    },
    pdf: "PDF",
    print: "Imprimir",
    createState: "Crear Estado",
    removeAllStates: "Borrar Todos los Estados",
    removeState: "Borrar Estado",
    renameState: "Renombrar Estado",
    savedStates: "Guardar Estado",
    stateRestore: "Restaurar Estado",
    updateState: "Actualizar Estado",
  },
  infoThousands: ",",
  loadingRecords: "Cargando...",
  paginate: {
    first: "Primero",
    last: "Último",
    next: "Siguiente",
    previous: "Anterior",
  },
  processing: "Procesando...",
  search: "Buscar:",
  searchBuilder: {
    add: "Añadir condición",
    button: {
      0: "Constructor de búsqueda",
      _: "Constructor de búsqueda (%d)",
    },
    clearAll: "Borrar todo",
    condition: "Condición",
    deleteTitle: "Eliminar regla de filtrado",
    leftTitle: "Criterios anulados",
    logicAnd: "Y",
    logicOr: "O",
    rightTitle: "Criterios de sangría",
    title: {
      0: "Constructor de búsqueda",
      _: "Constructor de búsqueda (%d)",
    },
    value: "Valor",
    conditions: {
      date: {
        after: "Después",
        before: "Antes",
        between: "Entre",
        empty: "Vacío",
        equals: "Igual a",
        not: "Diferente de",
        notBetween: "No entre",
        notEmpty: "No vacío",
      },
      number: {
        between: "Entre",
        empty: "Vacío",
        equals: "Igual a",
        gt: "Mayor a",
        gte: "Mayor o igual a",
        lt: "Menor que",
        lte: "Menor o igual a",
        not: "Diferente de",
        notBetween: "No entre",
        notEmpty: "No vacío",
      },
      string: {
        contains: "Contiene",
        empty: "Vacío",
        endsWith: "Termina con",
        equals: "Igual a",
        not: "Diferente de",
        startsWith: "Inicia con",
        notEmpty: "No vacío",
        notContains: "No Contiene",
        notEnds: "No Termina",
        notStarts: "No Comienza",
      },
      array: {
        equals: "Igual a",
        empty: "Vacío",
        contains: "Contiene",
        not: "Diferente",
        notEmpty: "No vacío",
        without: "Sin",
      },
    },
    data: "Datos",
  },
  searchPanes: {
    clearMessage: "Borrar todo",
    collapse: {
      0: "Paneles de búsqueda",
      _: "Paneles de búsqueda (%d)",
    },
    count: "{total}",
    emptyPanes: "Sin paneles de búsqueda",
    loadMessage: "Cargando paneles de búsqueda",
    title: "Filtros Activos - %d",
    countFiltered: "{shown} ({total})",
    collapseMessage: "Colapsar",
    showMessage: "Mostrar Todo",
  },
  select: {
    cells: {
      1: "1 celda seleccionada",
      _: "%d celdas seleccionadas",
    },
    columns: {
      1: "1 columna seleccionada",
      _: "%d columnas seleccionadas",
    },
  },
  thousands: ",",
  datetime: {
    previous: "Anterior",
    hours: "Horas",
    minutes: "Minutos",
    seconds: "Segundos",
    unknown: "-",
    amPm: ["am", "pm"],
    next: "Siguiente",
    months: {
      0: "Enero",
      1: "Febrero",
      10: "Noviembre",
      11: "Diciembre",
      2: "Marzo",
      3: "Abril",
      4: "Mayo",
      5: "Junio",
      6: "Julio",
      7: "Agosto",
      8: "Septiembre",
      9: "Octubre",
    },
    weekdays: [
      "Domingo",
      "Lunes",
      "Martes",
      "Miércoles",
      "Jueves",
      "Viernes",
      "Sábado",
    ],
  },
  editor: {
    close: "Cerrar",
    create: {
      button: "Nuevo",
      title: "Crear Nuevo Registro",
      submit: "Crear",
    },
    edit: {
      button: "Editar",
      title: "Editar Registro",
      submit: "Actualizar",
    },
    remove: {
      button: "Eliminar",
      title: "Eliminar Registro",
      submit: "Eliminar",
      confirm: {
        _: "¿Está seguro que desea eliminar %d filas?",
        1: "¿Está seguro que desea eliminar 1 fila?",
      },
    },
    multi: {
      title: "Múltiples Valores",
      restore: "Deshacer Cambios",
      noMulti:
        "Este registro puede ser editado individualmente, pero no como parte de un grupo.",
      info: "Los elementos seleccionados contienen diferentes valores para este registro. Para editar y establecer todos los elementos de este registro con el mismo valor, haga click o toque aquí, de lo contrario conservarán sus valores individuales.",
    },
    error: {
      system:
        'Ha ocurrido un error en el sistema (<a target="\\" rel="\\ nofollow" href="\\"> Más información</a>).',
    },
  },
  decimal: ".",
  emptyTable: "No hay datos disponibles en la tabla",
  zeroRecords: "No se encontraron coincidencias",
  info: "Mostrando _START_ a _END_ de _TOTAL_ entradas",
  infoEmpty: "Mostrando 0 a 0 de 0 entradas",
  infoFiltered: "(Filtrado de _MAX_ total de entradas)",
  lengthMenu: "Mostrar _MENU_ entradas",
  stateRestore: {
    removeTitle: "Eliminar",
    creationModal: {
      search: "Busccar",
    },
  },
};
// ############# METODOS METODOS #############
function validarInputSoloNumeros(evt) {
  let code = (evt.which) ? evt.which : evt.keyCode;
  if (code == 8) {
    return true;
  } else if (code >= 48 && code <= 57 || code == 43 || code == 32) {
    return true;
  } else {
    return false;
  }
}
// ----- cerrar modales ---------
$('#btnCerrarModalAgendarDemo').click(function () {
  $('#observacionAgendarDemo').val("");
  $('#observacionAgendarDemo').removeClass("border-success");
  $('#observacionAgendarDemo').addClass("border-danger");
  $('#tipoDemo').val("0");
  $('#tipoDemo').removeClass("border-success");
  $('#tipoDemo').addClass("border-danger");
  $('#fechaDemo').val("");
  $('#fechaDemo').removeClass("border-success");
  $('#fechaDemo').addClass("border-danger");
  $("#btnRechazar").prop("disabled", true);
});
$('#btnCerrarModalDemoCancelada').click(function () {
  $('#motivoCancela').val("");
  $('#motivoCancela').removeClass("border-success");
  $('#motivoCancela').addClass("border-danger");
  $('#btnConfirmarModalDemoCancelada').prop("disabled", true);
});
$('#btnCerrarModalDemoReprogramar').click(function () {
  $('#motivoReprogramar').val('');
  $('#motivoReprogramar').removeClass('border-success');
  $('#motivoReprogramar').addClass('border-danger');
  $('#fechaDemoReprogramar').val('');
  $('#fechaDemoReprogramar').removeClass('border-success');
  $('#fechaDemoReprogramar').addClass('border-danger');
  $('#btnConfirmarModalDemoReprogramar').prop("disabled", true);
});
// ---- validar boton reprogramar demo ------
$('#motivoReprogramar').keyup(function () {
  if ($('#motivoReprogramar').val().length >= 10) {
    $('#motivoReprogramar').removeClass('border-danger')
    $('#motivoReprogramar').addClass('border-success')
  } else {
    $('#motivoReprogramar').addClass('border-danger')
    $('#motivoReprogramar').removeClass('border-success')
  }
});
$('#fechaDemoReprogramar').change(function () {
  if ($('#fechaDemoReprogramar').val() != '') {
    $('#fechaDemoReprogramar').removeClass('border-danger')
    $('#fechaDemoReprogramar').addClass('border-success')
  } else {
    $('#fechaDemoReprogramar').removeClass('border-success')
    $('#fechaDemoReprogramar').addClass('border-danger')
  }
})
setInterval(() => {
  let motivo = $('#motivoReprogramar').hasClass('border-success')
  let fecha = $('#fechaDemoReprogramar').hasClass('border-success')
  if (fecha && motivo) {
    $('#btnConfirmarModalDemoReprogramar').prop('disabled', false)
  } else {
    $('#btnConfirmarModalDemoReprogramar').prop('disabled', true)
  }
}, 200);
// ---- validar boton rechazar realizar demo --------
$('#motivoCancela').keyup(function () {
  if ($('#motivoCancela').val().length >= 10) {
    $('#motivoCancela').removeClass('border-danger');
    $('#motivoCancela').addClass('border-success');
    $('#btnConfirmarModalDemoCancelada').prop('disabled', false);
  } else {
    $('#motivoCancela').removeClass('border-success');
    $('#motivoCancela').addClass('border-danger');
    $('#btnConfirmarModalDemoCancelada').prop('disabled', true)
  }
});
// ----- validar boton rechazar ---------
$('#observacionAgendarDemo').keyup(function () {
  if ($('#observacionAgendarDemo').val().length >= 10) {
    $('#observacionAgendarDemo').removeClass('border-danger')
    $('#observacionAgendarDemo').addClass('border-success')
    $('#btnRechazar').prop('disabled', false)
  } else {
    $('#observacionAgendarDemo').removeClass('border-success')
    $('#observacionAgendarDemo').addClass('border-danger')
    $('#btnRechazar').prop('disabled', true)
  }
})
// ----- validar boton agendar demo ----------
$('#tipoDemo').change(function () {
  if ($('#tipoDemo').val() != '0') {
    $('#tipoDemo').removeClass('border-danger')
    $('#tipoDemo').addClass('border-success')
  } else {
    $('#tipoDemo').removeClass('border-success')
    $('#tipoDemo').addClass('border-danger')
  }
})
$('#fechaDemo').change(function () {
  if ($('#fechaDemo').val() != '') {
    $('#fechaDemo').removeClass('border-danger')
    $('#fechaDemo').addClass('border-success')
  } else {
    $('#fechaDemo').removeClass('border-success')
    $('#fechaDemo').addClass('border-danger')
  }
})
setInterval(() => {
  let tipo = $('#tipoDemo').hasClass('border-success')
  let fecha = $('#fechaDemo').hasClass('border-success')
  let observacion = $('#observacionAgendarDemo').hasClass('border-success')
  if (tipo && fecha && observacion) {
    $('#btnGuardar').prop('disabled', false)
  } else {
    $('#btnGuardar').prop('disabled', true)
  }
}, 200);
// ############# ASIGNANDO FUNCIONES ##############
/*$('#tbody').on("click", '#btnAbriModalProgramarDemo', function () {
  let nombres = document.getElementById('nombres');
  let rubro = document.getElementById('rubro');
  let celular = document.getElementById('celular');
  let medioEnvioInfo = document.getElementById('medioEnvioInfo');
  let correoEnvio = document.getElementById('correoEnvio');
  let fechaDemo = document.getElementById('fechaDemo');
  let tipoDemo = document.getElementById('tipoDemo');
  setInterval(() => {
    if(medioEnvioInfo.value == 'email'){
      if(fechaDemo.value != ''){
        $("#btnGuardar").prop("disabled", true);
      }else{
        datosArray = [
          nombres, rubro, celular, medioEnvioInfo, fechaDemo, tipoDemo, correoEnvio
        ];
      }
    }else{
      datosArray = [
        nombres, rubro, celular, medioEnvioInfo, fechaDemo, tipoDemo
      ];
    }
    let respuesta = validarDatos(datosArray);
    if (Object.keys(respuesta).length == 0) {
      $("#btnGuardar").prop("disabled", false);
    } else {
      $("#btnGuardar").prop("disabled", true);
    }
  }, 200);
  setInterval(() => {
    if($('#fechaDemo').val() != ''){
      $("#divTipoDemo").css("display", "block");
    }else{
      $("#divTipoDemo").css("display", "none");
    }
  }, 100);
  setInterval(() => {
    if($('#medioEnvioInfo').val() == 'email'){
      $("#divCorreo").css("display", "block");
    }else{
      $("#divCorreo").css("display", "none");
    }
  }, 100);
  setInterval(() => {
    if (($('#observacionAgendarDemo')).val() != '') {
      $("#btnRechazar").prop("disabled", false);
    } else {
      $("#btnRechazar").prop("disabled", true);
    }
  }, 100);
})*/

// ######## LLENAR DATA TABLES ############
$(document).ready(function () {
  // TABLA DE PROGRAMAR DEMOSTRACIONES
  let llamadaPendienteTable = $("#solicLlamadaRealizadaTable").DataTable({
    ajax: {
      url: "../controllers/ControlSolicController.php?method=listarSolicLlamadasRealizadas",
      method: "GET",
    },
    columns: [
      { data: "indice" },
      { data: "cliente" },
      {
        data: "facebook",
        render: function (data, type, row) {
          if (row.canal == 'facebook') {
            if (row.facebook != '') {
              return `<a href="${row.facebook}" class="btn active" aria-current="page" target=”_blank”><span class="badge"><i class="fab fa-facebook" style="color:#395498; font-size: 20px"></i></span></a>`
            } else {
              return `<span class="badge bg-danger"><i class="fas fa-ban"></i></span>`
            }
          }
          if (row.canal == 'instagram') {
            if (row.facebook != '') {
              return `<a href="${row.facebook}" class="btn active" aria-current="page" target=”_blank”><span class="badge"><i class="fab fa-instagram" style="color:#f23e6b; font-size: 20px"></i></span></a>`
            } else {
              return `<span class="badge bg-danger"><i class="fas fa-ban"></i></span>`
            }
          }
          if (row.canal == 'tiktok') {
            if (row.facebook != '') {
              return `<a href="${row.facebook}" class="btn active" aria-current="page" target=”_blank”><span class="badge" style="background-color:#000000"><i class="fab fa-tiktok" style="color:white; font-size: 16px"></i></i></span></a>`
            } else {
              return `<span class="badge bg-danger"><i class="fas fa-ban"></i></span>`
            }
          }
          if (row.canal == 'youtube') {
            if (row.facebook != '') {
              return `<a href="${row.facebook}" class="btn active" aria-current="page" target=”_blank”><span class="badge"><i class="fab fa-youtube" style="color:#fa0001; font-size: 20px"></i></span></a>`
            } else {
              return `<span class="badge bg-danger"><i class="fas fa-ban"></i></span>`
            }
          }
          if (row.facebook == '') {
            return `<span class="badge bg-danger"><i class="fas fa-ban"></i></span>`
          }
        }
      },
      { data: "celular" },
      { data: "rubro" },
      {
        data: "tipoInformacion",
        render: function (data, type, row) {
          if (row.tipoInformacion == 'equi') {
            return `<span class="badge bg-info text-dark">EQUIPOS</i></span>`
          }
          if (row.tipoInformacion == 'gen') {
            return `<span class="badge bg-info text-dark">SISTEMAS Y EQUIPOS</i></span>`
          }
          if (row.tipoInformacion == 'sist') {
            return `<span class="badge bg-info text-dark">SISTEMA</i></span>`
          }
          if (row.tipoInformacion == 'noEspecifica') {
            return `<span class="badge bg-danger">No especifica</i></span>`
          }
        }
      },
      {
        data: "medioEnvioInfo",
        render: function (data, type, row) {
          if (row.medioEnvioInfo == 'wsp') {
            return `<span class="badge rounded-pill bg-success">WhatsApp</i></span>`
          } else {
            return `<span class="badge rounded-pill bg-info text-dark">Correo</i></span>`
          }
        }
      },
      {
        defaultContent: `
        <button type="button" id="btnAbriModalProgramarDemo" class="agendar btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#modalAgendarDemo"><i class="far fa-calendar-check"></i></button>
        `,
      },
    ],
    language: español,
  });
  // TABLA DE DEMOSTRACIONES PENDIENTES
  let demoPendienteTable = $("#solicDemoPendienteTable").DataTable({
    ajax: {
      url: "../controllers/ControlSolicController.php?method=listarSolicDemoPendientes",
      method: "GET",
    },
    columns: [
      { data: "indice" },
      { data: "cliente" },
      { data: "celular" },
      { data: "rubro" },
      {
        data: "medioEnvioInfo",
        render: function (data, type, row) {
          if (row.medioEnvioInfo == 'wsp') {
            return `<span class="badge rounded-pill" style="background-color:transparent;"><i class="fab fa-whatsapp" style="color: #57f773; font-size:20px; font-weight: bold"></i></span>`
          } else {
            return `<span class="badge rounded-pill" style="background-color:transparent;"><i class="far fa-envelope" style="color: black; font-size:18px; font-weight: bold"></i></span>`
          }
        }
      },
      { data: "fechaHoraDemo" },
      {
        defaultContent: `
        <button type="button" class="realizado btn btn-success btn-sm" data-toggle="tooltip" data-placement="bottom" title="Confirmar demo" data-bs-toggle="modal" data-bs-target="#demoRealizada"><i class="fas fa-check"></i></button>
        <button type="button" class="cancelado btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#modalDemoCancelada"><i class="fas fa-times-circle"></i></button>
        <button type="button" class="reprogramar btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#modalDemoReprogramar"><i class="fas fa-calendar-check"></i></button>
        `,
      },
    ],
    language: español,
  });
  // TABLA DE CIERRE DE VENTAS PENDIENTES
  let cierreVentaTable = $("#cierreVentasPendientesTable").DataTable({
    ajax: {
      url: "../controllers/ControlSolicController.php?method=listarSolicVentasPendientes",
      method: "GET",
    },
    columns: [
      { data: "indice" },
      { data: "cliente" },
      { data: "celular" },
      { data: "rubro" },
      {
        data: "medioEnvioInfo",
        render: function (data, type, row) {
          if (row.medioEnvioInfo == 'wsp') {
            return `<span class="badge rounded-pill" style="background-color:transparent;"><i class="fab fa-whatsapp" style="color: #57f773; font-size:20px; font-weight: bold"></i></span>`
          } else {
            return `<span class="badge rounded-pill" style="background-color:transparent;"><i class="far fa-envelope" style="color: black; font-size:18px; font-weight: bold"></i></span>`
          }
        }
      },
      {
        defaultContent: `<button type="button" class="cierreVenta btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#modalCerrarVenta"><i class="fas fa-check"></i></button>`,
      },
      // <button type="button" class="ventaCancelada btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#modalVentaCancelada"><i class="fas fa-times-circle"></i></button>
    ],
    language: español,
  });
  // Modal agendar demostracion con datos correspondientes
  $('#solicLlamadaRealizadaTable tbody').on("click", ".agendar", function () {
    let data = llamadaPendienteTable.row($(this).parents()).data();
    $('#tituloModal').text('Agendar demostracion')
    $('#idSolic').val(data.idSolicitud)
    $('#nombres').val(data.cliente)
    $('#rubro').val(data.rubro)
    $('#celular').val(data.celular)
    $('#medioEnvioInfo').val(data.medioEnvioInfo)
    if (data.medioEnvioInfo == 'email') {
      $('#divCorreo').css('display', 'block')
      $('#correoEnvio').val(data.correoEnvio)
    } else {
      $('#correoEnvio').val('')
      $('#divCorreo').css('display', 'none')
    }
    if (data.observacionEnvioInfo != '') {
      $('#divObservacionEnvioInfo').css('display', 'block')
      $('#observacionEnvioInfo').val(data.observacionEnvioInfo)
    } else {
      $('#divObservacionEnvioInfo').css('display', 'none')
      $('#observacionEnvioInfo').val('')
    }
  });
  // Proceso de agendar demostracion
  $("#btnGuardar").click(function (e) {
    let formData = new FormData();
    formData.append("idSolic", $('#idSolic').val());
    formData.append("fechaDemo", $('#fechaDemo').val());
    formData.append("tipoDemo", $('#tipoDemo').val());
    formData.append("observacionAgendarDemo", $('#observacionAgendarDemo').val());
    window.$.ajax({
      type: "post",
      url: "ControlSolicController.php?method=agendarDemostracion",
      data: formData,
      cache: false,
      processData: false,
      contentType: false,
      beforeSend: function () {
        Swal.fire({
          allowOutsideClick: false,
          title: 'Cargando',
          timerProgressBar: true,
          didOpen: () => {
            Swal.showLoading()
            const b = Swal.getHtmlContainer().querySelector('b')
            timerInterval = setInterval(() => {
            }, 300)
          }
        })
      },
      success: function (response) {
        Swal.close()
        llamadaPendienteTable.ajax.reload();
        demoPendienteTable.ajax.reload();
        let data = JSON.parse(response);
        if (data.estado == "ok") {
          $("#fechaDemo").val("");
          $("#fechaDemo").removeClass('border-success');
          $("#fechaDemo").addClass('border-danger');
          $("#tipoDemo").val("0");
          $("#tipoDemo").removeClass('border-success');
          $("#tipoDemo").addClass('border-danger');
          $("#observacionAgendarDemo").val("");
          $("#observacionAgendarDemo").removeClass('border-success');
          $("#observacionAgendarDemo").addClass('border-danger');
          $("#modalAgendarDemo").modal("hide");
          Swal.fire({
            text: data.mensaje,
            icon: 'success',
          })
          setTimeout(() => {
            Swal.close()
          }, 1200);
        } else {
          Swal.fire({
            text: data.mensaje,
            icon: 'error',
          })
          setTimeout(() => {
            Swal.close()
          }, 1200);
        }
      },
    });
  });
  // Proceso rechazo de agendar demostracion
  $('#btnRechazar').click(function (e) {
    let formData = new FormData;
    formData.append("idSolic", $('#idSolic').val());
    formData.append("observacion", $('#observacionAgendarDemo').val());
    window.$.ajax({
      type: "post",
      url: "ControlSolicController.php?method=rechazarAgendarDemo",
      data: formData,
      cache: false,
      processData: false,
      contentType: false,
      beforeSend: function () {
        Swal.fire({
          allowOutsideClick: false,
          title: 'Cargando',
          timerProgressBar: true,
          didOpen: () => {
            Swal.showLoading()
            const b = Swal.getHtmlContainer().querySelector('b')
            timerInterval = setInterval(() => {
            }, 300)
          }
        })
      },
      success: function (response) {
        Swal.close()
        llamadaPendienteTable.ajax.reload();
        let data = JSON.parse(response);
        if (data.estado == 'ok') {
          $("#observacionAgendarDemo").val("");
          $("#observacionAgendarDemo").removeClass("border-success");
          $("#observacionAgendarDemo").addClass("border-danger");
          $("#fechaDemo").val("");
          $("#fechaDemo").removeClass("border-success");
          $("#fechaDemo").addClass("border-danger");
          $("#tipoDemo").val("");
          $("#tipoDemo").removeClass("border-success");
          $("#tipoDemo").addClass("border-danger");
          $("#btnRechazar").prop("disabled", true);
          $("#modalAgendarDemo").modal("hide");
          Swal.fire({
            text: data.mensaje,
            icon: 'success',
          })
          setTimeout(() => {
            Swal.close()
          }, 1200);
        } else {
          $("#modalAgendarDemo").modal("hide");
          Swal.fire({
            text: data.mensaje,
            icon: 'error',
          })
        }
      },
    });
  });
  // Modal de confirmacion de realizacion de demostracion
  $('#solicDemoPendienteTable tbody').on("click", ".realizado", function () {
    let data = demoPendienteTable.row($(this).parents()).data();
    $('#nombreCliente').text((data.cliente).toUpperCase())
    $('#idClienteDemoRealizada').val(data.idSolicitud)
  });
  // Proceso de confirmarcion de realizacion de demostracion
  $('#btnConfirmarModalDemoRealizada').click(function (e) {
    let formData = new FormData;
    formData.append("idSolic", $('#idClienteDemoRealizada').val());
    window.$.ajax({
      type: "post",
      url: "ControlSolicController.php?method=confirmarDemoRealizada",
      data: formData,
      cache: false,
      processData: false,
      contentType: false,
      beforeSend: function () {
        Swal.fire({
          allowOutsideClick: false,
          title: 'Cargando',
          timerProgressBar: true,
          didOpen: () => {
            Swal.showLoading()
            const b = Swal.getHtmlContainer().querySelector('b')
            timerInterval = setInterval(() => {
            }, 300)
          }
        })
      },
      success: function (response) {
        Swal.close()
        demoPendienteTable.ajax.reload();
        cierreVentaTable.ajax.reload();
        let data = JSON.parse(response);
        if (data.estado == 'ok') {
          $("#demoRealizada").modal("hide");
          Swal.fire({
            text: data.mensaje,
            icon: 'success',
          })
          setTimeout(() => {
            Swal.close()
          }, 1500);
        } else {
          $("#demoRealizada").modal("hide");
          Swal.fire({
            text: data.mensaje,
            icon: 'error',
          })
        }
      },
    });
  });
  // Modal de cancelacion de realizacion de demostracion
  $('#solicDemoPendienteTable tbody').on("click", ".cancelado", function () {
    let data = demoPendienteTable.row($(this).parents()).data();
    $('#nombreClienteCancela').text((data.cliente).toUpperCase())
    $('#idClienteCancela').val(data.idSolicitud)
  });
  // Proceso de cancelacion de realizacion de demostracion
  $('#btnConfirmarModalDemoCancelada').click(function (e) {
    let formData = new FormData;
    formData.append("idSolic", $('#idClienteCancela').val());
    formData.append("motivo", $('#motivoCancela').val());
    window.$.ajax({
      type: "post",
      url: "ControlSolicController.php?method=cancelarDemo",
      data: formData,
      cache: false,
      processData: false,
      contentType: false,
      beforeSend: function () {
        Swal.fire({
          allowOutsideClick: false,
          title: 'Cargando',
          timerProgressBar: true,
          didOpen: () => {
            Swal.showLoading()
            const b = Swal.getHtmlContainer().querySelector('b')
            timerInterval = setInterval(() => {
            }, 300)
          }
        })
      },
      success: function (response) {
        Swal.close()
        demoPendienteTable.ajax.reload();
        cierreVentaTable.ajax.reload();
        let data = JSON.parse(response);
        if (data.estado == 'ok') {
          $('#motivoCancela').val('');
          $('#motivoCancela').removeClass('border-success');
          $('#motivoCancela').addClass('border-danger');
          $('#btnConfirmarModalDemoCancelada').prop("disabled", true);
          $("#modalDemoCancelada").modal("hide");
          Swal.fire({
            text: data.mensaje,
            icon: 'success',
          })
          setTimeout(() => {
            Swal.close()
          }, 1500);
        } else {
          Swal.fire({
            text: data.mensaje,
            icon: 'error',
          })
        }
      },
    });
  });
  // Modal de reprogramacion demostracion
  $('#solicDemoPendienteTable tbody').on("click", ".reprogramar", function () {
    let data = demoPendienteTable.row($(this).parents()).data();
    $('#idClienteReprogramar').val(data.idSolicitud)
  });
  // Proceso de reprogramacion de demostracion
  $('#btnConfirmarModalDemoReprogramar').click(function (e) {
    let formData = new FormData;
    formData.append("idSolic", $('#idClienteReprogramar').val());
    formData.append("motivo", $('#motivoReprogramar').val());
    formData.append("fecha", $('#fechaDemoReprogramar').val());
    // formData.append("fechaPasada", data.horaDemo);
    // formData.append("horaPasada", data.fechaDemo);
    window.$.ajax({
      type: "post",
      url: "ControlSolicController.php?method=reprogramarDemo",
      data: formData,
      cache: false,
      processData: false,
      contentType: false,
      beforeSend: function () {
        Swal.fire({
          allowOutsideClick: false,
          title: 'Cargando',
          timerProgressBar: true,
          didOpen: () => {
            Swal.showLoading()
            const b = Swal.getHtmlContainer().querySelector('b')
            timerInterval = setInterval(() => {
            }, 300)
          }
        })
      },
      success: function (response) {
        Swal.close()
        demoPendienteTable.ajax.reload();
        let data = JSON.parse(response);
        if (data.estado == 'ok') {
          $('#motivoReprogramar').val('');
          $('#motivoReprogramar').removeClass('border-success');
          $('#motivoReprogramar').addClass('border-danger');
          $('#fechaDemoReprogramar').val('');
          $('#fechaDemoReprogramar').removeClass('border-success');
          $('#fechaDemoReprogramar').addClass('border-danger');
          $('#btnConfirmarModalDemoReprogramar').prop("disabled", true);
          $("#modalDemoReprogramar").modal("hide");
          Swal.fire({
            text: data.mensaje,
            icon: 'success',
          })
          setTimeout(() => {
            Swal.close()
          }, 1500);
        } else {
          Swal.fire({
            text: data.mensaje,
            icon: 'error',
          })
        }
      },
    });
  });
  // Modal de Confirmar Venta
  $('#cierreVentasPendientesTable').on("click", ".cierreVenta", function () {
    let data = cierreVentaTable.row($(this).parents()).data();
    $('#clienteCierreVenta').text(data.cliente);
    $('#idClienteCierreVenta').val(data.idSolicitud);
  })
  // Proceso de cancelacion de realizacion de demostracion
  $('#btnConfirmarModalCierrarVenta').click(function (e) {
    let formData = new FormData;
    formData.append("idSolic", $('#idClienteCierreVenta').val());
    if ($('#pos').prop('checked')) {
      formData.append("pos", $('#pos').val());
    }
    if ($('#facturador').prop('checked')) {
      formData.append("facturador", $('#facturador').val());
    }
    if ($('#restoEscritorio').prop('checked')) {
      formData.append("restoEscritorio", $('#restoEscritorio').val());
    }
    if ($('#restoWeb').prop('checked')) {
      formData.append("restoWeb", $('#restoWeb').val());
    }
    if ($('#ticketera').prop('checked')) {
      formData.append("ticketera", $('#ticketera').val());
    }
    if ($('#allInOne').prop('checked')) {
      formData.append("allInOne", $('#allInOne').val());
    }
    if ($('#gavetaDinero').prop('checked')) {
      formData.append("gavetaDinero", $('#gavetaDinero').val());
    }
    if ($('#imprPortatil').prop('checked')) {
      formData.append("imprPortatil", $('#imprPortatil').val());
    }
    if ($('#impTermica').prop('checked')) {
      formData.append("impTermica", $('#impTermica').val());
    }
    if ($('#lecCodBarras').prop('checked')) {
      formData.append("lecCodBarras", $('#lecCodBarras').val());
    }
    if ($('#termPortatil').prop('checked')) {
      formData.append("termPortatil", $('#termPortatil').val());
    }
    if ($('#miniPc').prop('checked')) {
      formData.append("miniPc", $('#miniPc').val());
    }
    if ($('#suministros').prop('checked')) {
      formData.append("suministros", $('#suministros').val());
    }
    window.$.ajax({
      type: "post",
      url: "ControlSolicController.php?method=cerrarVenta",
      data: formData,
      cache: false,
      processData: false,
      contentType: false,
      beforeSend: function () {
        $("#modalCerrarVenta").modal("hide");
        $("#modalLoader").modal("show");
      },
      success: function (response) {
        let data = JSON.parse(response);
        if (data.estado == 'ok') {
          Swal.fire({
            text: data.mensaje,
            icon: 'success',
          })
          setTimeout(() => {
            $("#modalLoader").modal("hide");
            Swal.close()
            cierreVentaTable.ajax.reload();
          }, 2000);
        } else {
          Swal.fire({
            text: data.mensaje,
            icon: 'error',
          })
          setTimeout(() => {
            $("#modalLoader").modal("hide");
            Swal.close()
          }, 2000);
        }
      },
    });
  });
});
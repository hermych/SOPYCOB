let español = {
    aria: {
        sortAscending: "Activar para ordenar la columna de manera ascendente",
        sortDescending: "Activar para ordenar la columna de manera descendente",
    },
    autoFill: {
        cancel: "Cancelar",
        fill: "Rellene todas las celdas con <i>%d</i>",
        fillHorizontal: "Rellenar celdas horizontalmente",
        fillVertical: "Rellenar celdas verticalmente",
    },
    buttons: {
        collection: "Colección",
        colvis: "Visibilidad",
        colvisRestore: "Restaurar visibilidad",
        copy: "Copiar",
        copyKeys:
          "Presione ctrl o u2318 + C para copiar los datos de la tabla al portapapeles del sistema. <br /> <br /> Para cancelar, haga clic en este mensaje o presione escape.",
        copySuccess: {
            1: "Copiada 1 fila al portapapeles",
            _: "Copiadas %d fila al portapapeles",
        },
        copyTitle: "Copiar al portapapeles",
        csv: "CSV",
        excel: "Excel",
        pageLength: {
            "-1": "Mostrar todas las filas",
            _: "Mostrar %d filas",
        },
        pdf: "PDF",
        print: "Imprimir",
        createState: "Crear Estado",
        removeAllStates: "Borrar Todos los Estados",
        removeState: "Borrar Estado",
        renameState: "Renombrar Estado",
        savedStates: "Guardar Estado",
        stateRestore: "Restaurar Estado",
        updateState: "Actualizar Estado",
    },
    infoThousands: ",",
    loadingRecords: "Cargando...",
    paginate: {
        first: "Primero",
        last: "Último",
        next: "Siguiente",
        previous: "Anterior",
    },
    processing: "Procesando...",
    search: "Buscar:",
    searchBuilder: {
        add: "Añadir condición",
        button: {
            0: "Constructor de búsqueda",
            _: "Constructor de búsqueda (%d)",
        },
        clearAll: "Borrar todo",
        condition: "Condición",
        deleteTitle: "Eliminar regla de filtrado",
        leftTitle: "Criterios anulados",
        logicAnd: "Y",
        logicOr: "O",
        rightTitle: "Criterios de sangría",
        title: {
            0: "Constructor de búsqueda",
            _: "Constructor de búsqueda (%d)",
        },
        value: "Valor",
        conditions: {
            date: {
                after: "Después",
                before: "Antes",
                between: "Entre",
                empty: "Vacío",
                equals: "Igual a",
                not: "Diferente de",
                notBetween: "No entre",
                notEmpty: "No vacío",
            },
            number: {
                between: "Entre",
                empty: "Vacío",
                equals: "Igual a",
                gt: "Mayor a",
                gte: "Mayor o igual a",
                lt: "Menor que",
                lte: "Menor o igual a",
                not: "Diferente de",
                notBetween: "No entre",
                notEmpty: "No vacío",
            },
            string: {
                contains: "Contiene",
                empty: "Vacío",
                endsWith: "Termina con",
                equals: "Igual a",
                not: "Diferente de",
                startsWith: "Inicia con",
                notEmpty: "No vacío",
                notContains: "No Contiene",
                notEnds: "No Termina",
                notStarts: "No Comienza",
            },
            array: {
                equals: "Igual a",
                empty: "Vacío",
                contains: "Contiene",
                not: "Diferente",
                notEmpty: "No vacío",
                without: "Sin",
            },
        },
        data: "Datos",
    },
    searchPanes: {
        clearMessage: "Borrar todo",
        collapse: {
            0: "Paneles de búsqueda",
            _: "Paneles de búsqueda (%d)",
        },
        count: "{total}",
        emptyPanes: "Sin paneles de búsqueda",
        loadMessage: "Cargando paneles de búsqueda",
        title: "Filtros Activos - %d",
        countFiltered: "{shown} ({total})",
        collapseMessage: "Colapsar",
        showMessage: "Mostrar Todo",
    },
    select: {
        cells: {
            1: "1 celda seleccionada",
            _: "%d celdas seleccionadas",
        },
        columns: {
            1: "1 columna seleccionada",
            _: "%d columnas seleccionadas",
        },
    },
    thousands: ",",
    datetime: {
        previous: "Anterior",
        hours: "Horas",
        minutes: "Minutos",
        seconds: "Segundos",
        unknown: "-",
        amPm: ["am", "pm"],
        next: "Siguiente",
        months: {
            0: "Enero",
            1: "Febrero",
            10: "Noviembre",
            11: "Diciembre",
            2: "Marzo",
            3: "Abril",
            4: "Mayo",
            5: "Junio",
            6: "Julio",
            7: "Agosto",
            8: "Septiembre",
            9: "Octubre",
        },
        weekdays: [
            "Domingo",
            "Lunes",
            "Martes",
            "Miércoles",
            "Jueves",
            "Viernes",
            "Sábado",
        ],
    },
    editor: {
        close: "Cerrar",
        create: {
            button: "Nuevo",
            title: "Crear Nuevo Registro",
            submit: "Crear",
        },
        edit: {
            button: "Editar",
            title: "Editar Registro",
            submit: "Actualizar",
        },
        remove: {
            button: "Eliminar",
            title: "Eliminar Registro",
            submit: "Eliminar",
            confirm: {
                _: "¿Está seguro que desea eliminar %d filas?",
                1: "¿Está seguro que desea eliminar 1 fila?",
            },
        },
        multi: {
            title: "Múltiples Valores",
            restore: "Deshacer Cambios",
            noMulti:
              "Este registro puede ser editado individualmente, pero no como parte de un grupo.",
            info: "Los elementos seleccionados contienen diferentes valores para este registro. Para editar y establecer todos los elementos de este registro con el mismo valor, haga click o toque aquí, de lo contrario conservarán sus valores individuales.",
        },
        error: {
            system:
              'Ha ocurrido un error en el sistema (<a target="\\" rel="\\ nofollow" href="\\"> Más información</a>).',
        },
    },
    decimal: ".",
    emptyTable: "No hay datos disponibles en la tabla",
    zeroRecords: "No se encontraron coincidencias",
    info: "Mostrando _START_ a _END_ de _TOTAL_ entradas",
    infoEmpty: "Mostrando 0 a 0 de 0 entradas",
    infoFiltered: "(Filtrado de _MAX_ total de entradas)",
    lengthMenu: "Mostrar _MENU_ entradas",
    stateRestore: {
        removeTitle: "Eliminar",
        creationModal: {
            search: "Busccar",
        },
    },
};

// ############# METODOS METODOS #############
function validarDatos(datos) {
    respuesta = {};
    datos.forEach((dato) => {
        if (dato.value == "" || dato.value == "0") {
            respuesta[dato.name] = `El campo ${dato.name} es obligatorio`;
        }
        if (dato.name == 'dniContacto') {
            if ((dato.value).length != 8) {
                respuesta[dato.name] = `El DNI de contacto tiene que ser 8 digitos`;
            }
        }
    });
    return respuesta;
}
function validarInputSoloNumeros(evt) {
    let code = evt.which ? evt.which : evt.keyCode;
    if (code == 8) {
        // backspace.
        return true;
    } else if (code >= 48 && code <= 57) {
        // is a number.
        return true;
    } else {
        // other keys.
        return false;
    }
}
function reiniciarModalAgregarCliente() {
    $('#nroDocumento').val('')
    $('#nombreCliente').val('')
    $('#nombreComercial').val('')
    $('#celuCliente').val('')
    $('#emailCliente').val('')
    $('#telfCliente').val('')
    $('#idDepartamento').val('0')
    $('#idProvincia').val('0')
    $('#idDistrito').val('0')
    $('#direcCliente').val('')
    $('#nombreContacto').val('')
    $('#telfContacto').val('')
    $('#dniContacto').val('')
    $('#nroDocumento').removeClass('border-success')
    $('#nroDocumento').addClass('border-danger')
    $('#nombreCliente').removeClass('border-success')
    $('#nombreCliente').addClass('border-danger')
    $('#nombreComercial').removeClass('border-success')
    $('#nombreComercial').addClass('border-danger')
    $('#celuCliente').removeClass('border-success')
    $('#celuCliente').addClass('border-danger')
    $('#idDepartamento').removeClass('border-success')
    $('#idDepartamento').addClass('border-danger')
    $('#idProvincia').removeClass('border-success')
    $('#idProvincia').addClass('border-danger')
    $('#idDistrito').removeClass('border-success')
    $('#idDistrito').addClass('border-danger')
    $('#direcCliente').removeClass('border-success')
    $('#direcCliente').addClass('border-danger')
    $('#nombreContacto').removeClass('border-success')
    $('#nombreContacto').addClass('border-danger')
    $('#telfContacto').removeClass('border-success')
    $('#telfContacto').addClass('border-danger')
    $('#dniContacto').removeClass('border-success')
    $('#dniContacto').addClass('border-danger')

}
// ############# FUNCIONES PREVIAS PARA GUARDAR CLIENTE ##############
// Validar datos de celular cliente
$('#celuCliente').keyup(function () {
    if (($('#celuCliente').val()).length >= 9) {
        $("#celuCliente").removeClass("border-danger");
        $("#celuCliente").addClass("border-success");
    } else {
        $("#celuCliente").removeClass("border-success");
        $("#celuCliente").addClass("border-danger");
    }
});
// Traer lista de deparmentos para formulario guardar
$('#btnAbrirModalGuardarCliente').click(function () {
    window.$.ajax({
        type: "GET",
        url: "ClientesController.php?method=listarDeparmentos",
        success: function (response) {
            let data = JSON.parse(response);
            let selectDepa = document.getElementById("idDepartamento");
            contenido = "<option value='0'>Seleccione departamento</option>";
            data.forEach((depa) => {
                contenido += `<option value=${depa.idDepartamento}>${depa.nombreDepa}</option>`;
            });
            selectDepa.innerHTML = contenido;
        },
    });
})
// Traer lista de provincias para formulario guardar
$('#idDepartamento').change(function () {
    let selectProvincia = document.getElementById("idProvincia");
    let formData = new FormData();
    formData.append("idDep", $('#idDepartamento').val());
    window.$.ajax({
        type: "post",
        url: "ClientesController.php?method=listarProvincias",
        data: formData,
        cache: false,
        processData: false,
        contentType: false,
        success: function (response) {
            let data = JSON.parse(response);
            contenido = "<option value='0'>Seleccione provincia</option>";
            data.forEach((prov) => {
                contenido += `<option value=${prov.idProvincia}>${prov.nombreProvincia}</option>`;
            });
            selectProvincia.innerHTML = contenido;
        },
    });
    if ($('#idDepartamento').val() != '0') {
        $("#idDepartamento").removeClass("border-danger");
        $("#idDepartamento").addClass("border-success");
        $('#idProvincia').prop('disabled', false)
        $('#idDistrito').prop('disabled', true)
        $('#idDistrito').val('0')
        $("#idDistrito").removeClass("border-success");
        $("#idProvincia").removeClass("border-success");
        $("#idDistrito").addClass("border-danger");
        $("#idProvincia").addClass("border-danger");
    } else {
        $("#idDepartamento").removeClass("border-success");
        $("#idDepartamento").addClass("border-danger");
        $("#idProvincia").removeClass("border-success");
        $("#idProvincia").addClass("border-danger");
        $("#idDistrito").removeClass("border-success");
        $("#idDistrito").addClass("border-danger");
        $('#idProvincia').prop('disabled', true)
        $('#idDistrito').prop('disabled', true)
        $('#idProvincia').val('0')
        $('#idDistrito').val('0')
    }
})
// Traer lista de distritos para formulario guardar
$('#idProvincia').change(function () {
    let selectDistrito = document.getElementById("idDistrito");
    let formData = new FormData();
    formData.append("idProv", $('#idProvincia').val());
    formData.append("idDep", $('#idDepartamento').val());
    window.$.ajax({
        type: "post",
        url: "ClientesController.php?method=listarDistritos",
        data: formData,
        cache: false,
        processData: false,
        contentType: false,
        success: function (response) {
            let data = JSON.parse(response);
            contenido = "<option value='0'>Seleccione distrito</option>";
            data.forEach((prov) => {
                contenido += `<option value=${prov.idDistrito}>${prov.nombreDistrito}</option>`;
            });
            selectDistrito.innerHTML = contenido;
        },
    });
    if ($('#idProvincia').val() != '0') {
        $("#idProvincia").removeClass("border-danger");
        $("#idProvincia").addClass("border-success");
        $("#idDistrito").removeClass("border-success");
        $("#idDistrito").addClass("border-danger");
        $('#idDistrito').prop('disabled', false)
    } else {
        $("#idProvincia").removeClass("border-success");
        $("#idProvincia").addClass("border-danger");
        $('#idDistrito').prop('disabled', true)
        $('#idDistrito').val('0')
        $("#idDistrito").removeClass("border-success");
        $("#idDistrito").addClass("border-danger");
    }
})
// Validar al seleccionar el distrito
$('#idDistrito').change(function () {
    if ($('#idDistrito').val() != '0') {
        $("#idDistrito").removeClass("border-danger");
        $("#idDistrito").addClass("border-success");
    } else {
        $("#idDistrito").removeClass("border-success");
        $("#idDistrito").addClass("border-danger");
    }
})
// Buscar cliente por DNI para formulario guardar
$('#nroDocumento').keyup(function () {
    nroDoc = $('#nroDocumento').val();
    cantNroDoc = ($('#nroDocumento').val()).length
    if (cantNroDoc == 8) {
        url = `https://dniruc.apisperu.com/api/v1/dni/${nroDoc}?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJlbWFpbCI6Implc3VzLmh5Ljk2QGdtYWlsLmNvbSJ9.iFRy56HuRFPLb8YjRy6-09d_H7v6E-6-VT7VEj_L110`
        window.$.ajax({
            type: "get",
            url: url,
            beforeSend: function () {
                $('#loaderDni').css("display", "block");
                $('#searchDni').css("display", "none");
            },
            success: function (datos) {
                $('#loaderDni').css("display", "none");
                $('#searchDni').css("display", "block");
                if (datos.nombres == undefined || datos.apellidoPaterno == undefined || datos.apellidoMaterno == undefined) {
                    $('#nombreCliente').attr('disabled', false)
                    $("#nombreCliente").removeClass("border-success");
                    $("#nombreCliente").addClass("border-danger");
                } else {
                    $('#nombreCliente').attr('disabled', true)
                    $('#direcCliente').attr('disabled', false)
                    let nombreCompleto = `${datos.nombres} ${datos.apellidoPaterno} ${datos.apellidoMaterno}`
                    $('#nombreCliente').val(nombreCompleto);
                    $("#nombreCliente").removeClass("border-danger");
                    $("#nombreCliente").addClass("border-success");
                }
                $("#nroDocumento").removeClass("border-danger");
                $("#nroDocumento").addClass("border-success");
            },
        });
    }
    if (cantNroDoc == 11) {
        url = `https://dniruc.apisperu.com/api/v1/ruc/${nroDoc}?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJlbWFpbCI6Implc3VzLmh5Ljk2QGdtYWlsLmNvbSJ9.iFRy56HuRFPLb8YjRy6-09d_H7v6E-6-VT7VEj_L110`
        window.$.ajax({
            type: "get",
            url: url,
            beforeSend: function () {
                $('#loaderDni').css("display", "block");
                $('#searchDni').css("display", "none");
            },
            success: function (datos) {
                console.log(datos);
                $('#loaderDni').css("display", "none");
                $('#searchDni').css("display", "block");
                $('#divNombreComercial').css("display", "block");
                if (datos.success == false) {
                    $("#nombreCliente").removeClass("border-success");
                    $("#nombreCliente").addClass("border-danger");
                } else {
                    $('#nombreCliente').val(datos.razonSocial);
                    $('#direcCliente').attr('disabled', false)
                    $('#direcCliente').val(datos.direccion);
                    $("#nroDocumento").removeClass("border-danger");
                    $("#nroDocumento").addClass("border-success");
                    $("#nombreCliente").removeClass("border-danger");
                    $("#nombreCliente").addClass("border-success");
                    $("#direcCliente").removeClass("border-danger");
                    $("#direcCliente").addClass("border-success");
                }
            },
        });
    }
    if (cantNroDoc != 8 || cantNroDoc != 11) {
        $('#nombreCliente').attr('disabled', true)
        $('#nombreCliente').val("");
        $('#direcCliente').val("");
        $('#nombreComercial').val("");
        $("#nroDocumento").removeClass("border-success");
        $("#nroDocumento").addClass("border-danger");
        $("#nombreCliente").removeClass("border-success");
        $("#nombreCliente").addClass("border-danger");
        $("#direcCliente").removeClass("border-success");
        $("#direcCliente").addClass("border-danger");

    }
})
// Validar datos de registrar clientes llenos
$("#btnAbrirModalGuardarCliente").click(() => {
    let respuesta = false;
    setInterval(() => {
        if($("#nroDocumento").hasClass("border-danger") || $("#nombreCliente").hasClass("border-danger") || $("#celuCliente").hasClass("border-danger") || $("#idDepartamento").hasClass("border-danger") || $("#idProvincia").hasClass("border-danger") || $("#idDistrito").hasClass("border-danger") || $("#nombreContacto").hasClass("border-danger") || $("#telfContacto").hasClass("border-danger") || $("#dniContacto").hasClass("border-danger") ||  $("#direcCliente").hasClass("border-danger")){
            $('#btnGuardar').prop('disabled', true)
        }else{
            $('#btnGuardar').prop('disabled', false)
        }
    }, 200);
});
// Validar datos de direccion del cliente
$('#direcCliente').keyup(function () {
    if (($('#direcCliente').val()).length > 10) {
        $("#direcCliente").removeClass("border-danger");
        $("#direcCliente").addClass("border-success");
    } else {
        $("#direcCliente").removeClass("border-success");
        $("#direcCliente").addClass("border-danger");
    }
});
// Validar datos de Nombre de contacto del cliente
$('#nombreContacto').keyup(function () {
    if (($('#nombreContacto').val()).length > 5) {
        $("#nombreContacto").removeClass("border-danger");
        $("#nombreContacto").addClass("border-success");
    } else {
        $("#nombreContacto").removeClass("border-success");
        $("#nombreContacto").addClass("border-danger");
    }
});
// Validar datos de celular de contacto del cliente
$('#telfContacto').keyup(function () {
    if (($('#telfContacto').val()).length >= 9) {
        $("#telfContacto").removeClass("border-danger");
        $("#telfContacto").addClass("border-success");
    } else {
        $("#telfContacto").removeClass("border-success");
        $("#telfContacto").addClass("border-danger");
    }
});
// Validar datos de celular de contacto del cliente
$('#dniContacto').keyup(function () {
    if (($('#dniContacto').val()).length == 8) {
        $("#dniContacto").removeClass("border-danger");
        $("#dniContacto").addClass("border-success");
    } else {
        $("#dniContacto").removeClass("border-success");
        $("#dniContacto").addClass("border-danger");
    }
});
// Validar datos de celular de contacto del cliente
$('#nombreCliente').keyup(function () {
    if (($('#nombreCliente').val()).length > 8) {
        $("#nombreCliente").removeClass("border-danger");
        $("#nombreCliente").addClass("border-success");
    } else {
        $("#nombreCliente").removeClass("border-success");
        $("#nombreCliente").addClass("border-danger");
    }
});
// Guardar a cliente

/********************************** ********************************/
// Traer lista de provincias para formulario editar
$("#idDepartamentoEdit").on("change", function () {
    let selectDepaEdit = document.getElementById('idDepartamentoEdit');
    let selectProvinciaEdit = document.getElementById("idProvinciaEdit");
    let formData = new FormData();
    formData.append("idDep", selectDepaEdit.value);
    window.$.ajax({
        type: "post",
        url: "ClientesController.php?method=listarProvincias",
        data: formData,
        cache: false,
        processData: false,
        contentType: false,
        success: function (response) {
            $('#idProvinciaEdit').prop('disabled', false)
            let data = JSON.parse(response);
            contenido = "<option value='0'>Provincias</option>";
            data.forEach((prov) => {
                contenido += `<option value=${prov.idProvincia}>${prov.nombreProvincia}</option>`;
            });
            selectProvinciaEdit.innerHTML = contenido;
            $('#idDistrito').prop('disabled', true)
        },
    });
});
// Traer lista de distritos para formulario editar
$("#idProvinciaEdit").on("change", function () {
    let selectDepaEdit = document.getElementById('idDepartamentoEdit');
    let selectProvinciaEdit = document.getElementById("idProvinciaEdit");
    let selectDistritoEdit = document.getElementById("idDistritoEdit");
    let formData = new FormData();
    formData.append("idDep", selectDepaEdit.value);
    formData.append("idProv", selectProvinciaEdit.value);
    window.$.ajax({
        type: "post",
        url: "ClientesController.php?method=listarDistritos",
        data: formData,
        cache: false,
        processData: false,
        contentType: false,
        success: function (response) {
            $('#idDistrito').prop('disabled', false)
            let data = JSON.parse(response);
            contenido = "<option value='0'>Distritos</option>";
            data.forEach((prov) => {
                contenido += `<option value=${prov.idDistrito}>${prov.nombreDistrito}</option>`;
            });
            selectDistritoEdit.innerHTML = contenido;
        },
    });
});

// Buscar cliente por DNI para formulario editar
let inputDocumentoEdit = document.getElementById('nroDocumentoEdit');
inputDocumentoEdit.addEventListener("keyup", function () {
    nroDoc = inputDocumentoEdit.value;
    cantNroDoc = (inputDocumentoEdit.value).length
    if (cantNroDoc == 8) {
        url = `https://dniruc.apisperu.com/api/v1/dni/${nroDoc}?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJlbWFpbCI6Implc3VzLmh5Ljk2QGdtYWlsLmNvbSJ9.iFRy56HuRFPLb8YjRy6-09d_H7v6E-6-VT7VEj_L110`
        window.$.ajax({
            type: "get",
            url: url,
            beforeSend: function () {
                $('#loaderDni').css("display", "block");
                $('#searchDni').css("display", "none");
            },
            success: function (datos) {
                $('#loaderDni').css("display", "none");
                $('#searchDni').css("display", "block");
                let nombreCompleto = `${datos.nombres} ${datos.apellidoPaterno} ${datos.apellidoMaterno}`
                $('#nombreClienteEdit').val(nombreCompleto);
            },
        });
    }


    if (cantNroDoc == 11) {
        url = `https://dniruc.apisperu.com/api/v1/ruc/${nroDoc}?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJlbWFpbCI6Implc3VzLmh5Ljk2QGdtYWlsLmNvbSJ9.iFRy56HuRFPLb8YjRy6-09d_H7v6E-6-VT7VEj_L110`
        window.$.ajax({
            type: "get",
            url: url,
            beforeSend: function () {
                $('#loaderDni').css("display", "block");
                $('#searchDni').css("display", "none");

            },
            success: function (datos) {
                $('#loaderDni').css("display", "none");
                $('#searchDni').css("display", "block");
                let nombreCompleto = `${datos.razonSocial}`
                $('#nombreClienteEdit').val(nombreCompleto);
                $('#direcCliente').val(datos.direccion);
            },
        });
    }

    if (cantNroDoc != 8 || cantNroDoc != 11) {
        $('#nombreClienteEdit').val("");
        $('#direcCliente').val("");
    }
})

// ######## LLENAR DATA TABLE ############
$(document).ready(function () {
    let dataTable = $("#clientesDataTable").DataTable({
        ajax: {
            url: "../controllers/ClientesController.php?method=listarClientes",
            method: "GET",
        },
        columns: [
            {data: "indice"},
            {data: "nombreCliente"},
            {data: "nombreComercial"},
            {data: "celularCliente"},
            //{data: "emailCliente"},
            {data: "direccionCliente"},
            {data: "nroDocumento"},
            {
                defaultContent: `
          <button type="button" id="btnVerContacto" class="verContacto btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#modalVerContacto"><i class="fas fa-eye"></i></button>
          <button type="button" id="btnAbriModalEditarCliente" class="editar btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#modalEditarCliente"><i class="fas fa-edit"></i></button>
          <button type="button" class="inhabilitar btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#modalInhabilitarCliente"><i class="fas fa-trash-alt"></i></button>
          `,
            },
        ],
        language: español,
    });
    // Modal Editar con datos correspondientes
    $("#clientesDataTable tbody").on("click", ".editar", function () {
        let data = dataTable.row($(this).parents()).data();
        window.$.ajax({
            type: "GET",
            url: "ClientesController.php?method=listarDeparmentos",
            success: function (response) {
                let data = JSON.parse(response);
                let selectDepa = document.getElementById("idDepartamentoEdit");
                contenido = "<option value='0'>Departamentos</option>";
                data.forEach((depa) => {
                    contenido += `<option value=${depa.idDepartamento}>${depa.nombreDepa}</option>`;
                });
                selectDepa.innerHTML = contenido;
            },
            complete: function () {
                $("#idDepartamentoEdit").val(data.idDepartamento);
                $('#nombreComercialEdit').val(data.nombreComercial)
            }
        });
        $("#idClienteEdit").val(data.idCliente);
        $("#nroDocumentoEdit").val(data.nroDocumento);
        $("#nombreClienteEdit").val(data.nombreCliente);
        $("#celuClienteEdit").val(data.celularCliente);
        $("#emailClienteEdit").val(data.emailCliente);
        $("#telfClienteEdit").val(data.telefonoCliente);
        $("#direcClienteEdit").val(data.direccionCliente);
        $("#nombreContactoProvEdit").val(data.nombreContacto);
        $("#telfContactoProvEdit").val(data.nroContacto);
        $("#dniContactoEdit").val(data.nroDocContacto);
    });
    $("#clientesDataTable tbody").on("click", ".editar", function () {
        let data = dataTable.row($(this).parents()).data();
        let selectProvincia = document.getElementById('idProvinciaEdit');
        let formData = new FormData();
        formData.append("idDep", data.idDepartamento);
        window.$.ajax({
            type: "post",
            url: "ClientesController.php?method=listarProvincias",
            data: formData,
            cache: false,
            processData: false,
            contentType: false,
            success: function (response) {
                let data = JSON.parse(response);
                contenido = "<option value='0'>Provincias</option>";
                data.forEach((prov) => {
                    contenido += `<option value=${prov.idProvincia}>${prov.nombreProvincia}</option>`;
                });
                selectProvincia.innerHTML = contenido;
            },
            complete: function () {
                $("#idProvinciaEdit").val(data.idProvincia);
            }
        });
    });
    $("#clientesDataTable tbody").on("click", ".editar", function () {
        let data = dataTable.row($(this).parents()).data();
        let selectDistrito = document.getElementById('idDistritoEdit');
        let formData = new FormData();
        formData.append("idDep", data.idDepartamento);
        formData.append("idProv", data.idProvincia);
        window.$.ajax({
            type: "post",
            url: "ClientesController.php?method=listarDistritos",
            data: formData,
            cache: false,
            processData: false,
            contentType: false,
            success: function (response) {
                let data = JSON.parse(response);
                contenido = "<option value='0'>Distritos</option>";
                data.forEach((prov) => {
                    contenido += `<option value=${prov.idDistrito}>${prov.nombreDistrito}</option>`;
                });
                selectDistrito.innerHTML = contenido;
            },
            complete: function () {
                $("#idDistritoEdit").val(data.idDistrito);
            }
        });
    });

    // Modal Inhabilitar Cliente con datos correspondientes
    $("#clientesDataTable tbody").on("click", ".inhabilitar", function () {
        let data = dataTable.row($(this).parents()).data();
        $("#nombreClienteInhabilitarP").text(data.nombreCliente);
        $("#idClienteInhabilitar").val(data.idCliente);
    });

    // Modal Contacto con datos correspondientes
    $("#clientesDataTable tbody").on("click", ".verContacto", function () {
        let data = dataTable.row($(this).parents()).data();
        $("#nombreContacto2").val(data.nombreContacto);
        $("#nroDocConta").val(data.nroDocContacto);
        $("#telefonoContacto").val(data.nroContacto);
    });

    // Proceso de guardar Cliente
    $("#btnGuardar").click(function (e) {
        let tipoDoc;
        if (($('#nroDocumento').val()).length == 8) {
            tipoDoc = 1;
        } else {
            tipoDoc = 2;
        }
        let formData = new FormData();
        formData.append("nroDocumento", $('#nroDocumento').val());
        formData.append("tipoDoc", tipoDoc);
        formData.append("nombreCliente", $('#nombreCliente').val());
        formData.append("nombreComercial", $('#nombreComercial').val());
        formData.append("celuCliente", $('#celuCliente').val());
        formData.append("emailCliente", $('#emailCliente').val());
        formData.append("telfCliente", $('#telfCliente').val());
        formData.append("idDepartamento", $('#idDepartamento').val());
        formData.append("idProvincia", $('#idProvincia').val());
        formData.append("idDistrito", $('#idDistrito').val());
        formData.append("direcCliente", $('#direcCliente').val());
        formData.append("nombreContactoProv", $('#nombreContacto').val());
        formData.append("telfContactoProv", $('#telfContacto').val());
        formData.append("dniContactoProv", $('#dniContacto').val());
        window.$.ajax({
            type: "post",
            url: "ClientesController.php?method=guardarCliente",
            data: formData,
            cache: false,
            processData: false,
            contentType: false,
            beforeSend: function () {
                Swal.fire({
                    allowOutsideClick: false,
                    title: 'Cargando',
                    timerProgressBar: true,
                    didOpen: () => {
                        Swal.showLoading()
                        const b = Swal.getHtmlContainer().querySelector('b')
                        timerInterval = setInterval(() => {
                        }, 300)
                    }
                })
            },
            success: function (response) {
                Swal.close()
                let data = JSON.parse(response);
                if (data.estado == "ok") {
                    reiniciarModalAgregarCliente();
                    $("#modalGuardarCliente").modal("hide");
                    dataTable.ajax.reload();
                    Swal.fire({
                        text: data.mensaje,
                        icon: "success",
                    });
                    setTimeout(() => {
                        Swal.close();
                    }, 750);
                } else {
                    Swal.fire({
                        text: data.mensaje,
                        icon: "error",
                    });
                    setTimeout(() => {
                        Swal.close();
                    }, 2000);
                }
            },
        });
    });

    // Proceso de editar Cliente
    $("#btnEditarCliente").click(function (e) {
        let nroDocumentoEdit = document.getElementById("nroDocumentoEdit");
        let tipoDoc;
        if ((nroDocumentoEdit.value).length == 8) {
            tipoDoc = 1;
        } else {
            tipoDoc = 2;
        }
        let idClienteEdit = document.getElementById("idClienteEdit");
        let nombreClienteEdit = document.getElementById("nombreClienteEdit");
        let nombreComercialEdit = document.getElementById("nombreComercialEdit");
        let celuClienteEdit = document.getElementById("celuClienteEdit");
        let emailClienteEdit = document.getElementById("emailClienteEdit");
        let telfClienteEdit = document.getElementById("telfClienteEdit");
        let idDepartamentoEdit = document.getElementById("idDepartamentoEdit");
        let idProvinciaEdit = document.getElementById("idProvinciaEdit");
        let idDistritoEdit = document.getElementById("idDistritoEdit");
        let direcClienteEdit = document.getElementById("direcClienteEdit");
        let nombreContactoProvEdit = document.getElementById("nombreContactoProvEdit");
        let telfContactoProvEdit = document.getElementById("telfContactoProvEdit");
        let dniContactoEdit = document.getElementById("dniContactoEdit");
        let formData = new FormData();
        formData.append("idClienteEdit", idClienteEdit.value);
        formData.append("nroDocumentoEdit", nroDocumentoEdit.value);
        formData.append("tipoDoc", tipoDoc);
        formData.append("nombreClienteEdit", nombreClienteEdit.value);
        formData.append("nombreComercialEdit", nombreComercialEdit.value);
        formData.append("celuClienteEdit", celuClienteEdit.value);
        formData.append("emailClienteEdit", emailClienteEdit.value);
        formData.append("telfClienteEdit", telfClienteEdit.value);
        formData.append("idDepartamentoEdit", idDepartamentoEdit.value);
        formData.append("idProvinciaEdit", idProvinciaEdit.value);
        formData.append("idDistritoEdit", idDistritoEdit.value);
        formData.append("direcClienteEdit", direcClienteEdit.value);
        formData.append("nombreContactoProvEdit", nombreContactoProvEdit.value);
        formData.append("telfContactoProvEdit", telfContactoProvEdit.value);
        formData.append("dniContactoEdit", dniContactoEdit.value);
        window.$.ajax({
            type: "post",
            url: "ClientesController.php?method=editarCliente",
            data: formData,
            cache: false,
            processData: false,
            contentType: false,
            beforeSend: function () {
                Swal.fire({
                    allowOutsideClick: false,
                    title: 'Cargando',
                    timerProgressBar: true,
                    didOpen: () => {
                        Swal.showLoading()
                        const b = Swal.getHtmlContainer().querySelector('b')
                        timerInterval = setInterval(() => {

                        }, 300)
                    }
                })
            },
            success: function (response) {
                setTimeout(() => {
                    Swal.close()
                }, 2000);
                let data = JSON.parse(response);
                if (data.estado == "ok") {
                    $("#modalEditarCliente").modal("hide");
                    Swal.fire({
                        text: data.mensaje,
                        icon: "success",
                    });
                    setTimeout(() => {
                        Swal.close();
                        dataTable.ajax.reload();
                    }, 750);
                } else {
                    $("#modalEditarCliente").modal("hide");
                    Swal.fire({
                        text: data.mensaje,
                        icon: "error",
                    });
                    setTimeout(() => {
                        Swal.close();
                    }, 750);
                }
            },
        });
    });

    // Proceso de inhabilitar Cliente
    $("#btnInhabilitarCliente").click(function (e) {
        let idProveedor = document.getElementById("idClienteInhabilitar");
        let formData = new FormData();
        formData.append("idCliente", idProveedor.value);
        window.$.ajax({
            type: "post",
            url: "ClientesController.php?method=inhabilitarCliente",
            data: formData,
            cache: false,
            processData: false,
            contentType: false,
            beforeSend: function () {
                Swal.fire({
                    allowOutsideClick: false,
                    title: 'Cargando',
                    timerProgressBar: true,
                    didOpen: () => {
                        Swal.showLoading()
                        const b = Swal.getHtmlContainer().querySelector('b')
                        timerInterval = setInterval(() => {
                        }, 300)
                    }
                })
            },
            success: function (response) {
                setTimeout(() => {
                    Swal.close()
                }, 2000);
                let data = JSON.parse(response);
                if (data.estado == "ok") {
                    $("#modalInhabilitarCliente").modal("hide");
                    Swal.fire({
                        text: data.mensaje,
                        icon: "success",
                    });
                    setTimeout(() => {
                        Swal.close();
                        dataTable.ajax.reload();
                    }, 900);
                } else {
                    $("#modalInhabilitarCliente").modal("hide");
                    Swal.fire({
                        text: data.mensaje,
                        icon: "error",
                    });
                }
            },
        });
    });

});
// Limpiar inputs de modal de agregar
setInterval(() => {
    if (!($("#modalGuardarCliente").hasClass("show"))) {
        $("#nroDocumento").val('')
        $("#nombreCliente").val('')
        $("#nombreComercial").val('')
        $("#celuCliente").val('')
        $("#emailCliente").val('')
        $("#telfCliente").val('')
        $("#idDepartamento").val('0')
        $("#idProvincia").val('0')
        $("#idDistrito").val('0')
        $("#direcCliente").val('')
        $("#nombreContactoProv").val('')
        $("#telfContactoProv").val('')
        $("#dniContacto").val('')
    }
}, 500);

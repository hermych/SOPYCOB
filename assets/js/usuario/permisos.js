let español = {
  aria: {
    sortAscending: "Activar para ordenar la columna de manera ascendente",
    sortDescending: "Activar para ordenar la columna de manera descendente",
  },
  autoFill: {
    cancel: "Cancelar",
    fill: "Rellene todas las celdas con <i>%d</i>",
    fillHorizontal: "Rellenar celdas horizontalmente",
    fillVertical: "Rellenar celdas verticalmente",
  },
  buttons: {
    collection: "Colección",
    colvis: "Visibilidad",
    colvisRestore: "Restaurar visibilidad",
    copy: "Copiar",
    copyKeys:
      "Presione ctrl o u2318 + C para copiar los datos de la tabla al portapapeles del sistema. <br /> <br /> Para cancelar, haga clic en este mensaje o presione escape.",
    copySuccess: {
      1: "Copiada 1 fila al portapapeles",
      _: "Copiadas %d fila al portapapeles",
    },
    copyTitle: "Copiar al portapapeles",
    csv: "CSV",
    excel: "Excel",
    pageLength: {
      "-1": "Mostrar todas las filas",
      _: "Mostrar %d filas",
    },
    pdf: "PDF",
    print: "Imprimir",
    createState: "Crear Estado",
    removeAllStates: "Borrar Todos los Estados",
    removeState: "Borrar Estado",
    renameState: "Renombrar Estado",
    savedStates: "Guardar Estado",
    stateRestore: "Restaurar Estado",
    updateState: "Actualizar Estado",
  },
  infoThousands: ",",
  loadingRecords: "Cargando...",
  paginate: {
    first: "Primero",
    last: "Último",
    next: "Siguiente",
    previous: "Anterior",
  },
  processing: "Procesando...",
  search: "Buscar:",
  searchBuilder: {
    add: "Añadir condición",
    button: {
      0: "Constructor de búsqueda",
      _: "Constructor de búsqueda (%d)",
    },
    clearAll: "Borrar todo",
    condition: "Condición",
    deleteTitle: "Eliminar regla de filtrado",
    leftTitle: "Criterios anulados",
    logicAnd: "Y",
    logicOr: "O",
    rightTitle: "Criterios de sangría",
    title: {
      0: "Constructor de búsqueda",
      _: "Constructor de búsqueda (%d)",
    },
    value: "Valor",
    conditions: {
      date: {
        after: "Después",
        before: "Antes",
        between: "Entre",
        empty: "Vacío",
        equals: "Igual a",
        not: "Diferente de",
        notBetween: "No entre",
        notEmpty: "No vacío",
      },
      number: {
        between: "Entre",
        empty: "Vacío",
        equals: "Igual a",
        gt: "Mayor a",
        gte: "Mayor o igual a",
        lt: "Menor que",
        lte: "Menor o igual a",
        not: "Diferente de",
        notBetween: "No entre",
        notEmpty: "No vacío",
      },
      string: {
        contains: "Contiene",
        empty: "Vacío",
        endsWith: "Termina con",
        equals: "Igual a",
        not: "Diferente de",
        startsWith: "Inicia con",
        notEmpty: "No vacío",
        notContains: "No Contiene",
        notEnds: "No Termina",
        notStarts: "No Comienza",
      },
      array: {
        equals: "Igual a",
        empty: "Vacío",
        contains: "Contiene",
        not: "Diferente",
        notEmpty: "No vacío",
        without: "Sin",
      },
    },
    data: "Datos",
  },
  searchPanes: {
    clearMessage: "Borrar todo",
    collapse: {
      0: "Paneles de búsqueda",
      _: "Paneles de búsqueda (%d)",
    },
    count: "{total}",
    emptyPanes: "Sin paneles de búsqueda",
    loadMessage: "Cargando paneles de búsqueda",
    title: "Filtros Activos - %d",
    countFiltered: "{shown} ({total})",
    collapseMessage: "Colapsar",
    showMessage: "Mostrar Todo",
  },
  select: {
    cells: {
      1: "1 celda seleccionada",
      _: "%d celdas seleccionadas",
    },
    columns: {
      1: "1 columna seleccionada",
      _: "%d columnas seleccionadas",
    },
  },
  thousands: ",",
  datetime: {
    previous: "Anterior",
    hours: "Horas",
    minutes: "Minutos",
    seconds: "Segundos",
    unknown: "-",
    amPm: ["am", "pm"],
    next: "Siguiente",
    months: {
      0: "Enero",
      1: "Febrero",
      10: "Noviembre",
      11: "Diciembre",
      2: "Marzo",
      3: "Abril",
      4: "Mayo",
      5: "Junio",
      6: "Julio",
      7: "Agosto",
      8: "Septiembre",
      9: "Octubre",
    },
    weekdays: [
      "Domingo",
      "Lunes",
      "Martes",
      "Miércoles",
      "Jueves",
      "Viernes",
      "Sábado",
    ],
  },
  editor: {
    close: "Cerrar",
    create: {
      button: "Nuevo",
      title: "Crear Nuevo Registro",
      submit: "Crear",
    },
    edit: {
      button: "Editar",
      title: "Editar Registro",
      submit: "Actualizar",
    },
    remove: {
      button: "Eliminar",
      title: "Eliminar Registro",
      submit: "Eliminar",
      confirm: {
        _: "¿Está seguro que desea eliminar %d filas?",
        1: "¿Está seguro que desea eliminar 1 fila?",
      },
    },
    multi: {
      title: "Múltiples Valores",
      restore: "Deshacer Cambios",
      noMulti:
        "Este registro puede ser editado individualmente, pero no como parte de un grupo.",
      info: "Los elementos seleccionados contienen diferentes valores para este registro. Para editar y establecer todos los elementos de este registro con el mismo valor, haga click o toque aquí, de lo contrario conservarán sus valores individuales.",
    },
    error: {
      system:
        'Ha ocurrido un error en el sistema (<a target="\\" rel="\\ nofollow" href="\\"> Más información</a>).',
    },
  },
  decimal: ".",
  emptyTable: "No hay datos disponibles en la tabla",
  zeroRecords: "No se encontraron coincidencias",
  info: "Mostrando _START_ a _END_ de _TOTAL_ entradas",
  infoEmpty: "Mostrando 0 a 0 de 0 entradas",
  infoFiltered: "(Filtrado de _MAX_ total de entradas)",
  lengthMenu: "Mostrar _MENU_ entradas",
  stateRestore: {
    removeTitle: "Eliminar",
    creationModal: {
      search: "Busccar",
    },
  },
};
// ############# METODOS METODOS #############
function validarDatos(datos) {
  respuesta = {};
  datos.forEach((dato) => {
    if (dato.value == "" || dato.value == "0") {
      respuesta[dato.name] = `El campo ${dato.name} es obligatorio`;
    }
  });
  return respuesta;
}
function validarInputSoloNumeros(evt) {
  let code = (evt.which) ? evt.which : evt.keyCode;
  if (code == 8) { // backspace.
    return true;
  } else if (code >= 48 && code <= 57 || code == 46) { // is a number.
    return true;
  } else { // other keys.
    return false;
  }
}
// ############# ASIGNANDO FUNCIONES ##############
$("#btnAbrirModalGuardarUsuario").click(() => {
  let nombreUsuario = document.getElementById("nombreUsuario");
  let apellidoUsuario = document.getElementById("apellidoUsuario");
  let tipoDocUsuario = document.getElementById("tipoDocUsuario");
  let nroDocUsuario = document.getElementById("nroDocUsuario");
  let celUsuario = document.getElementById("celUsuario");
  let emailUsuario = document.getElementById("emailUsuario");
  let direcUsuario = document.getElementById("direcUsuario");
  let rolUsuario = document.getElementById("rolUsuario");
  let contraUsuario = document.getElementById("contraUsuario");
  datosArray = [
    nombreUsuario, apellidoUsuario, tipoDocUsuario, nroDocUsuario, celUsuario, emailUsuario, direcUsuario, rolUsuario, contraUsuario
  ];
  window.$.ajax({
    type: "GET",
    url: "UsuarioController.php?method=listarRoles",
    success: function (response) {
      let data = JSON.parse(response);
      let rolUsuario = document.getElementById("rolUsuario");
      contenido = "<option value=0 selected>Seleccion Rol</option>";
      data.forEach((rol) => {
        contenido += `<option value=${rol.idRol}>${rol.nombre}</option>`;
      });
      rolUsuario.innerHTML = contenido;
    },
  });
  setInterval(() => {
    let respuesta = validarDatos(datosArray);
    if (Object.keys(respuesta).length == 0) {
      if (tipoDocUsuario.value == 1) {
        if (nroDocUsuario.value.length == 8) {
          $("#btnGuardarUsuario").prop("disabled", false);
        } else {
          $("#btnGuardarUsuario").prop("disabled", true);
        }
      } else if (tipoDocUsuario.value == 2) {
        if (nroDocUsuario.value.length == 11) {
          $("#btnGuardarUsuario").prop("disabled", false);
        } else {
          $("#btnGuardarUsuario").prop("disabled", true);
        }
      } else {
        $("#btnGuardarUsuario").prop("disabled", true);
      }
    } else {
      $("#btnGuardarUsuario").prop("disabled", true);
    }
  }, 200);
});
$('#rolUsuario').change(function () {
  window.$.ajax({
    type: "GET",
    url: "SucursalController.php?method=listarSucursalesActivos",
    beforeSend: function () {
      Swal.fire({
        allowOutsideClick: false,
        title: 'Cargando',
        timerProgressBar: true,
        didOpen: () => {
          Swal.showLoading()
          const b = Swal.getHtmlContainer().querySelector('b')
          timerInterval = setInterval(() => {
          }, 300)
        }
      })
    },
    success: function (response) {
      Swal.close()
      let data = JSON.parse(response);
      let sucursales = document.getElementById("sucursalUsuario");
      contenido = '<option value="0">Seleccion Sucursal</option>';
      data.forEach((sucursal) => {
        contenido += `<option value=${sucursal.idSucursal}>${sucursal.nombre}</option>`;
      });
      sucursales.innerHTML = contenido;
    },
  });
})
$('#tbody').on("click", '#btnAbriModalEditarUsuario', function () {
  let nombres = document.getElementById("editNombreUsuario");
  let apellidos = document.getElementById("editApellidosUsuario");
  let tipoDoc = document.getElementById("editTipoDocUsuario");
  let nroDoc = document.getElementById("editNroDocUsuario");
  let celular = document.getElementById("editCelUsuario");
  let email = document.getElementById("editEmailUsuario");
  let direccion = document.getElementById("editDirecUsuario");
  let rol = document.getElementById("editRolUsuario");
  let password = document.getElementById("editContrUsuario");
  datosArray = [nombres, apellidos, tipoDoc, nroDoc, celular, email, direccion, rol, password];
  setInterval(() => {
    let respuesta = validarDatos(datosArray);
    if (Object.keys(respuesta).length == 0) {
      if (tipoDoc.value == 1) {
        if (nroDoc.value.length == 8) {
          $("#btnEditarUsuario").prop("disabled", false);
        } else {
          $("#btnEditarUsuario").prop("disabled", true);
        }
      } else if (tipoDoc.value == 2) {
        if (nroDoc.value.length == 11) {
          $("#btnEditarUsuario").prop("disabled", false);
        } else {
          $("#btnEditarUsuario").prop("disabled", true);
        }
      } else {
        $("#btnEditarUsuario").prop("disabled", true);
      }
    } else {
      $("#btnEditarUsuario").prop("disabled", true);
    }
  }, 300);
})
// ######## LLENAR DATA TABLE ############
$(document).ready(function () {
  let dataTable = $("#usuarioDataTable").DataTable({
    ajax: {
      url: "../controllers/UsuarioController.php?method=listarUsuarios",
      method: "GET",
    },
    columns: [
      { data: "indice" },
      { data: "nombreApellido" },
      { data: "nroDocumento" },
      { data: "celular" },
      { data: "email" },
      {
        defaultContent: `
        <button type="button" id="btnAbriModalEditarUsuario" class="editar btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#modalEditarUsuario"><i class="fas fa-edit"></i></button>
        <button type="button" class="inhabilitar btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#modalInhabilitarUsuario"><i class="fas fa-trash-alt"></i></button>
        <button type="button" class="darPermisos btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#modalBrindarPermisos"><i class="fa fa-key" aria-hidden="true"></i></button>
        `,
      },
    ],
    language: español,
  });
  // Modal Editar con datos correspondientes
  $('#usuarioDataTable tbody').on("click", ".editar", function () {
    let data = dataTable.row($(this).parents()).data();
    window.$.ajax({
      type: "GET",
      url: "UsuarioController.php?method=listarRoles",
      success: function (response) {
        let datos = JSON.parse(response);
        let rolUsuario = document.getElementById("editRolUsuario");
        contenido = "";
        datos.forEach((rol) => {
          contenido += `<option value=${rol.idRol}>${rol.nombre}</option>`;
        });
        rolUsuario.innerHTML = contenido;
        $('#editRolUsuario').val(data.idRol)
      }
    });
    $('#editNombreUsuario').val(data.nombre)
    $('#editApellidosUsuario').val(data.apellido)
    if (data.documento == 'DNI') {
      $('#editTipoDocUsuario').val("1")
    } else {
      $('#editTipoDocUsuario').val("2")
    }
    $('#editNroDocUsuario').val(data.nroDocumento)
    $('#editCelUsuario').val(data.celular)
    $('#editEmailUsuario').val(data.email)
    $('#editDirecUsuario').val(data.direccion)
    $('#editContrUsuario').val(data.contrasena)
    $('#idUsuarioEditar').val(data.idUsuario)
  });
  /// Modal Inhabilitar usuario con datos correspondientes
  $('#usuarioDataTable tbody').on("click", ".inhabilitar", function () {
    let data = dataTable.row($(this).parents()).data();
    $('#nombreUsuarioInhabilitarP').text(data.nombreApellido);
    $('#idUsuarioInhabilitar').val(data.idUsuario);
  });
  /// Modal otorgarPermisos por usuario con datos correspondientes
  $('#usuarioDataTable tbody').on("click", ".darPermisos", function () {
    let data = dataTable.row($(this).parents()).data();
    let idEmpleado = data.idUsuario;
    $('#idEmpleadoPermiso').val(data.idUsuario);
    let formData = new FormData();
    formData.append('idEmpleado', idEmpleado);
    window.$.ajax({
      type: "post",
      url: "PermisosController.php?method=listarPermisos",
      data: formData,
      cache: false,
      processData: false,
      contentType: false,
      beforeSend: function () {
        Swal.fire({
          allowOutsideClick: false,
          title: 'Cargando',
          timerProgressBar: true,
          didOpen: () => {
            Swal.showLoading()
            const b = Swal.getHtmlContainer().querySelector('b')
            timerInterval = setInterval(() => {
            }, 300)
          }
        })
      },
      success: function (response) {
        let data = JSON.parse(response);
        console.log(data);
        if (data.length != 0) {
          for (let i = 0; i < data.length; i++) {
            let permiso = data[i];
            let idPermiso = data[i].valor
            switch (idPermiso) {
              case '1':
                if (permiso.estado == 'activo') {
                  $('#dashSoporte').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#dashSoporte').attr('checked', false)
                }
                break;
              case '2':
                if (permiso.estado == 'activo') {
                  $('#dashCobranza').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#dashCobranza').attr('checked', false)
                }
                break;
              case '3':
                if (permiso.estado == 'activo') {
                  $('#dashComunity').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#dashComunity').attr('checked', false)
                }
                break;
              case '4':
                if (permiso.estado == 'activo') {
                  $('#permisoClientes').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#permisoClientes').attr('checked', false)
                }
                break;
              case '5':
                if (permiso.estado == 'activo') {
                  $('#permisoProveedor').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#permisoProveedor').attr('checked', false)
                }
                break;
              case '6':
                if (permiso.estado == 'activo') {
                  $('#permisoCategoria').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#permisoCategoria').attr('checked', false)
                }
                break;
              case '7':
                if (permiso.estado == 'activo') {
                  $('#permisoServicio').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#permisoServicio').attr('checked', false)
                }
                break;
              case '8':
                if (permiso.estado == 'activo') {
                  $('#permisoEstados').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#permisoEstados').attr('checked', false)
                }
                break;
              case '9':
                if (permiso.estado == 'activo') {
                  $('#permisoProcesos').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#permisoProcesos').attr('checked', false)
                }
                break;
              case '10':
                if (permiso.estado == 'activo') {
                  $('#permisoAdministrarCaja').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#permisoAdministrarCaja').attr('checked', false)
                }
                break;
              case '11':
                if (permiso.estado == 'activo') {
                  $('#permisoHistorialCaja').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#permisoHistorialCaja').attr('checked', false)
                }
                break;
              case '12':
                if (permiso.estado == 'activo') {
                  $('#permisoContratos').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#permisoContratos').attr('checked', false)
                }
                break;
              case '13':
                if (permiso.estado == 'activo') {
                  $('#permisoPensiones').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#permisoPensiones').attr('checked', false)
                }
                break;
              case '14':
                if (permiso.estado == 'activo') {
                  $('#permisoClienteServicio').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#permisoClienteServicio').attr('checked', false)
                }
                break;
              case '15':
                if (permiso.estado == 'activo') {
                  $('#permisoTiposComprobantes').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#permisoTiposComprobantes').attr('checked', false)
                }
                break;
              case '16':
                if (permiso.estado == 'activo') {
                  $('#permisoSerieComprobante').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#permisoSerieComprobante').attr('checked', false)
                }
                break;
              case '17':
                if (permiso.estado == 'activo') {
                  $('#permisoUsuarios').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#permisoUsuarios').attr('checked', false)
                }
                break;
              case '18':
                if (permiso.estado == 'activo') {
                  $('#permisoCargos').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#permisoCargos').attr('checked', false)
                }
                break;
              case '19':
                if (permiso.estado == 'activo') {
                  $('#permisoPermisos').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#permisoPermisos').attr('checked', false)
                }
                break;
              case '20':
                if (permiso.estado == 'activo') {
                  $('#permisoDatos').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#permisoDatos').attr('checked', false)
                }
                break;
              case '21':
                if (permiso.estado == 'activo') {
                  $('#permisoSucursal').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#permisoSucursal').attr('checked', false)
                }
                break;
              case '22':
                if (permiso.estado == 'activo') {
                  $('#permisoRegTicket').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#permisoRegTicket').attr('checked', false)
                }
                break;
              case '23':
                if (permiso.estado == 'activo') {
                  $('#permisoSuspencion').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#permisoSuspencion').attr('checked', false)
                }
                break;
              case '24':
                if (permiso.estado == 'activo') {
                  $('#permisoDarBaja').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#permisoDarBaja').attr('checked', false)
                }
                break;
              case '25':
                if (permiso.estado == 'activo') {
                  $('#permisoSolic').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#permisoSolic').attr('checked', false)
                }
                break;
              case '26':
                if (permiso.estado == 'activo') {
                  $('#permisoAtencion').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#permisoAtencion').attr('checked', false)
                }
                break;
              case '27':
                if (permiso.estado == 'activo') {
                  $('#permisoRealizarInst').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#permisoRealizarInst').attr('checked', false)
                }
                break;
              case '28':
                if (permiso.estado == 'activo') {
                  $('#permisoAltaSistemas').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#permisoAltaSistemas').attr('checked', false)
                }
                break;
              case '29':
                if (permiso.estado == 'activo') {
                  $('#permisoAgendarInst').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#permisoAgendarInst').attr('checked', false)
                }
                break;
              case '30':
                if (permiso.estado == 'activo') {
                  $('#permisoReportes').attr('checked', true)
                }
                if (permiso.estado == 'inhabilitado') {
                  $('#permisoReportes').attr('checked', false)
                }
                break;
            }
          }
        } else {
          $('#dashCobranza').attr('checked', false)
          $('#dashSoporte').attr('checked', false)
          $('#dashComunity').attr('checked', false)
          $('#permisoServicio').attr('checked', false)
          $('#permisoCategoria').attr('checked', false)
          $('#permisoProveedor').attr('checked', false)
          $('#permisoAdministrarCaja').attr('checked', false)
          $('#permisoHistorialCaja').attr('checked', false)
          $('#permisoTiposComprobantes').attr('checked', false)
          $('#permisoSerieComprobante').attr('checked', false)
          $('#permisoDatos').attr('checked', false)
          $('#permisoSucursal').attr('checked', false)
          $('#permisoSolic').attr('checked', false)
          $('#permisoAtencion').attr('checked', false)
          $('#permisoClientes').attr('checked', false)
          $('#permisoProcesos').attr('checked', false)
          $('#permisoEstados').attr('checked', false)
          $('#permisoContratos').attr('checked', false)
          $('#permisoPensiones').attr('checked', false)
          $('#permisoClienteServicio').attr('checked', false)
          $('#permisoCargos').attr('checked', false)
          $('#permisoUsuarios').attr('checked', false)
          $('#permisoPermisos').attr('checked', false)
          $('#permisoRegTicket').attr('checked', false)
          $('#permisoSuspencion').attr('checked', false)
          $('#permisoDarBaja').attr('checked', false)
          $('#permisoRealizarInst').attr('checked', false)
          $('#permisoAltaSistemas').attr('checked', false)
          $('#permisoAgendarInst').attr('checked', false)
          $('#permisoReportes').attr('checked', false)
        }
        Swal.close()
      },
    });
    $('#idUsuarioPermiso').val(data.idUsuario);
  });
  // Proceso de guardar usuario
  $("#btnGuardarUsuario").click(function (e) {
    let formData = new FormData();
    formData.append("nombres", ($('#nombreUsuario').val()).toUpperCase());
    formData.append("apellidos", ($('#apellidoUsuario').val()).toUpperCase());
    formData.append("tipoDoc", $('#tipoDocUsuario').val());
    formData.append("nroDoc", $('#nroDocUsuario').val());
    formData.append("celular", $('#celUsuario').val());
    formData.append("email", $('#emailUsuario').val());
    formData.append("direccion", ($('#direcUsuario').val()).toUpperCase());
    formData.append("rol", $('#rolUsuario').val());
    formData.append("sucursal", $('#sucursalUsuario').val());
    formData.append("password", $('#contraUsuario').val());
    window.$.ajax({
      type: "post",
      url: "UsuarioController.php?method=guardarUsuario",
      data: formData,
      cache: false,
      processData: false,
      contentType: false,
      beforeSend: function () {
        Swal.fire({
          allowOutsideClick: false,
          title: 'Cargando',
          timerProgressBar: true,
          didOpen: () => {
            Swal.showLoading()
            const b = Swal.getHtmlContainer().querySelector('b')
            timerInterval = setInterval(() => {
            }, 300)
          }
        })
      },
      success: function (response) {
        Swal.close()
        let data = JSON.parse(response);
        if (data.estado == "ok") {
          dataTable.ajax.reload();
          $("#guardaUsuario").modal("hide");
          $('#nombreUsuario').val("");
          $('#apellidoUsuario').val("");
          $('#tipoDocUsuario').val("0");
          $('#nroDocUsuario').val("");
          $('#celUsuario').val("");
          $('#emailUsuario').val("");
          $('#direcUsuario').val("");
          $('#rolUsuario').val("0");
          $('#sucursalUsuario').val("0");
          $('#contraUsuario').val("");
          Swal.fire({
            text: data.mensaje,
            icon: "success",
          });
          setTimeout(() => {
            Swal.close();
          }, 1000);
        } else if (data.estado == 'existeEmail') {
          Swal.fire({
            text: data.mensaje,
            icon: "error",
          });
          setTimeout(() => {
            Swal.close();
          }, 1500);
        } else {
          Swal.fire({
            text: data.mensaje,
            icon: "error",
          });
          setTimeout(() => {
            Swal.close();
          }, 1500);
        }
      },
    });
  });
  // Proceso de editar usuario
  $('#btnEditarUsuario').click(function (e) {
    let idUsuario = document.getElementById("idUsuarioEditar");
    let nombres = document.getElementById("editNombreUsuario");
    let apellidos = document.getElementById("editApellidosUsuario");
    let tipoDoc = document.getElementById("editTipoDocUsuario");
    let nroDoc = document.getElementById("editNroDocUsuario");
    let celular = document.getElementById("editCelUsuario");
    let email = document.getElementById("editEmailUsuario");
    let direccion = document.getElementById("editDirecUsuario");
    let rol = document.getElementById("editRolUsuario");
    let password = document.getElementById("editContrUsuario");
    let formData = new FormData;
    formData.append("nombres", nombres.value);
    formData.append("apellidos", apellidos.value);
    formData.append("tipoDoc", tipoDoc.value);
    formData.append("nroDoc", nroDoc.value);
    formData.append("celular", celular.value);
    formData.append("email", email.value);
    formData.append("direccion", direccion.value);
    formData.append("rol", rol.value);
    formData.append("password", password.value);
    formData.append("idUsuario", idUsuario.value);
    window.$.ajax({
      type: "post",
      url: "UsuarioController.php?method=editarUsuario",
      data: formData,
      cache: false,
      processData: false,
      contentType: false,
      beforeSend: function () {
        Swal.fire({
          allowOutsideClick: false,
          title: 'Cargando',
          timerProgressBar: true,
          didOpen: () => {
            Swal.showLoading()
            const b = Swal.getHtmlContainer().querySelector('b')
            timerInterval = setInterval(() => {
            }, 300)
          }
        })
      },
      success: function (response) {
        let data = JSON.parse(response);
        if (data.estado = 'ok') {
          nombres.value = "";
          apellidos.value = "";
          tipoDoc.value = "0";
          nroDoc.value = "";
          celular.value = "";
          email.value = "";
          direccion.value = "";
          rol.value = "0";
          password.value = "";
          $("#modalEditarUsuario").modal("hide");
          Swal.fire({
            // title: 'Realizado!',
            text: data.mensaje,
            icon: 'success',
          })
          setTimeout(() => {
            Swal.close()
            dataTable.ajax.reload();
          }, 900);
          Swal.close()
        }
      },
    });
  })
  // Proceso de inhabilitar usuario
  $('#btnInhabilitarUsuario').click(function (e) {
    let idUsuario = document.getElementById("idUsuarioInhabilitar");
    let formData = new FormData;
    formData.append("idUsuario", idUsuario.value);
    window.$.ajax({
      type: "post",
      url: "UsuarioController.php?method=inhabilitarUsuario",
      data: formData,
      cache: false,
      processData: false,
      contentType: false,
      beforeSend: function () {
        Swal.fire({
          allowOutsideClick: false,
          title: 'Cargando',
          timerProgressBar: true,
          didOpen: () => {
            Swal.showLoading()
            const b = Swal.getHtmlContainer().querySelector('b')
            timerInterval = setInterval(() => {
            }, 300)
          }
        })
      },
      success: function (response) {
        let data = JSON.parse(response);
        if (data.estado == 'ok') {
          $("#modalInhabilitarUsuario").modal("hide");
          Swal.fire({
            text: data.mensaje,
            icon: 'success',
          })
          setTimeout(() => {
            Swal.close()
            dataTable.ajax.reload();
          }, 900);
        }
        Swal.close()
      },
    });
  })
  // Proceso de ortorgar Permisos a usuario
  $('#btnGuardarPermisos').click(function (e) {
    let idEmpleado = (document.getElementById('idEmpleadoPermiso').value);
    let dashCobranza = (document.getElementById("dashCobranza").checked == true) ? 'activo' : 'inhabilitado';
    let dashSoporte = (document.getElementById("dashSoporte").checked == true) ? 'activo' : 'inhabilitado';
    let dashComunity = (document.getElementById("dashComunity").checked == true) ? 'activo' : 'inhabilitado';
    let p_servicio = (document.getElementById("permisoServicio").checked == true) ? 'activo' : 'inhabilitado';
    let p_categoria = (document.getElementById("permisoCategoria").checked == true) ? 'activo' : 'inhabilitado';
    let p_proveedor = (document.getElementById("permisoProveedor").checked == true) ? 'activo' : 'inhabilitado';
    let p_admiCaja = (document.getElementById("permisoAdministrarCaja").checked == true) ? 'activo' : 'inhabilitado';
    let p_histCaja = (document.getElementById("permisoHistorialCaja").checked == true) ? 'activo' : 'inhabilitado';
    let p_tipoComp = (document.getElementById("permisoTiposComprobantes").checked == true) ? 'activo' : 'inhabilitado';
    let p_serieComp = (document.getElementById("permisoSerieComprobante").checked == true) ? 'activo' : 'inhabilitado';
    let p_datos = (document.getElementById("permisoDatos").checked == true) ? 'activo' : 'inhabilitado';
    let p_sucursal = (document.getElementById("permisoSucursal").checked == true) ? 'activo' : 'inhabilitado';
    let p_solic = (document.getElementById("permisoSolic").checked == true) ? 'activo' : 'inhabilitado';
    let p_atencion = (document.getElementById("permisoAtencion").checked == true) ? 'activo' : 'inhabilitado';
    let p_cliente = (document.getElementById("permisoClientes").checked == true) ? 'activo' : 'inhabilitado';
    let p_proceso = (document.getElementById("permisoProcesos").checked == true) ? 'activo' : 'inhabilitado';
    let p_estados = (document.getElementById("permisoEstados").checked == true) ? 'activo' : 'inhabilitado';
    let p_contrato = (document.getElementById("permisoContratos").checked == true) ? 'activo' : 'inhabilitado';
    let p_pension = (document.getElementById("permisoPensiones").checked == true) ? 'activo' : 'inhabilitado';
    let p_clienteServ = (document.getElementById("permisoClienteServicio").checked == true) ? 'activo' : 'inhabilitado';
    let p_cargo = (document.getElementById("permisoCargos").checked == true) ? 'activo' : 'inhabilitado';
    let p_usuario = (document.getElementById("permisoUsuarios").checked == true) ? 'activo' : 'inhabilitado';
    let p_permiso = (document.getElementById("permisoPermisos").checked == true) ? 'activo' : 'inhabilitado';
    let p_ticket = (document.getElementById("permisoRegTicket").checked == true) ? 'activo' : 'inhabilitado';
    let p_suspencion = (document.getElementById("permisoSuspencion").checked == true) ? 'activo' : 'inhabilitado';
    let p_baja = (document.getElementById("permisoDarBaja").checked == true) ? 'activo' : 'inhabilitado';
    let permisoRealizarInst = (document.getElementById("permisoRealizarInst").checked == true) ? 'activo' : 'inhabilitado';
    let p_reportes = (document.getElementById("permisoReportes").checked == true) ? 'activo' : 'inhabilitado';
    let p_altaSistemas = (document.getElementById("permisoAltaSistemas").checked == true) ? 'activo' : 'inhabilitado';
    let p_agendarInst = (document.getElementById("permisoAgendarInst").checked == true) ? 'activo' : 'inhabilitado';
    let formData = new FormData;
    formData.append("idEmpleado", idEmpleado);
    formData.append("dashCobranza", dashCobranza);
    formData.append("dashSoporte", dashSoporte);
    formData.append("dashComunity", dashComunity);
    formData.append("p_servicio", p_servicio);
    formData.append("p_categoria", p_categoria);
    formData.append("p_proveedor", p_proveedor);
    formData.append("p_admiCaja", p_admiCaja);
    formData.append("p_histCaja", p_histCaja);
    formData.append("p_tipoComp", p_tipoComp);
    formData.append("p_serieComp", p_serieComp);
    formData.append("p_datos", p_datos);
    formData.append("p_sucursal", p_sucursal);
    formData.append("p_solic", p_solic);
    formData.append("p_atencion", p_atencion);
    formData.append("p_cliente", p_cliente);
    formData.append("p_proceso", p_proceso);
    formData.append("p_estados", p_estados);
    formData.append("p_contrato", p_contrato);
    formData.append("p_pension", p_pension);
    formData.append("p_clienteServ", p_clienteServ);
    formData.append("p_cargo", p_cargo);
    formData.append("p_usuario", p_usuario);
    formData.append("p_permiso", p_permiso);
    formData.append("p_ticket", p_ticket);
    formData.append("p_suspencion", p_suspencion);
    formData.append("p_baja", p_baja);
    formData.append("permisoRealizarInst", permisoRealizarInst);
    formData.append("p_reportes", p_reportes);
    formData.append("p_altaSistemas", p_altaSistemas);
    formData.append("p_agendarInst", p_agendarInst);
    window.$.ajax({
      type: "post",
      url: "PermisosController.php?method=otorgarPermisos",
      data: formData,
      cache: false,
      processData: false,
      contentType: false,
      beforeSend: function () {
        Swal.fire({
          //allowOutsideClick: false,
          title: 'Cargando',
          timerProgressBar: true,
          didOpen: () => {
            Swal.showLoading()
            const b = Swal.getHtmlContainer().querySelector('b')
            timerInterval = setInterval(() => {
            }, 300)
          }
        })
      },
      success: function (response) {
        let data = JSON.parse(response);
        if (data.estado == 'ok') {
          $("#modalBrindarPermisos").modal("hide");
          Swal.fire({
            text: data.mensaje,
            icon: 'success',
          })
          setTimeout(() => {
            Swal.close()
            //dataTable.ajax.reload();
            //window.location.replace("http://www.matrizsoporteycobranza.sigefac.com/controllers/PermisosController.php?method=permisos");
          }, 900);
          Swal.close()
        }
      },
    });
  })
});
// Limpiar inputs de modal de agregar
setInterval(() => {
  if (!($("#guardaUsuario").hasClass("show"))) {
    $("#nombreUsuario").val('')
    $("#apellidoUsuario").val('')
    $("#tipoDocUsuario").val('0')
    $("#nroDocUsuario").val('')
    $("#celUsuario").val('')
    $("#emailUsuario").val('')
    $("#direcUsuario").val('')
    $("#rolUsuario").val('0')
    $("#rolUscontraUsuariouario").val('')
  }
}, 500);


